<div *ngIf="mode==null">
    <div class="card">
        <p-table #dt [value]="lstUserMaster" styleClass="p-datatable-striped" [rowHover]="true"
            [globalFilterFields]="['HomeCode','HomeName','UserTypeName','LoginId','FullName']"
            [scrollable]="true" scrollHeight="calc(100vh - 180px)" (onFilter)="onFilter($event, dt)">
            <ng-template pTemplate="caption">
                <div class="flex justify-content-between flex-column sm:flex-row">
                    <span class="p-ml-left">
                        <button pButton title="Add New User" label="Add New" class="p-button-outlined mr-2"
                            icon="pi pi-plus" (click)="AddUserDetails()"></button>
                        <span class="total-txt">{{lstUserMaster?.length>0?'Total Records:
                        '+filteredValuesLength:''}} </span>
                    </span>
                    <span class="p-ml-auto">
                        <span>
                            <button *ngIf="lstUserMaster?.length>0" pButton title="Export Data" label=" "
                                class="p-button-outlined mr-2" icon="pi pi-download"
                                (click)="exportToItemExcel();"></button>
                        </span>
                        <span class="p-input-icon-left">
                            <i class="pi pi-search"></i>
                            <input #filtr pInputText type="text" (input)="onGlobalFilter(dt, $event)"
                                placeholder="Search..." />
                        </span>
                    </span>
                </div>
            </ng-template>
            <ng-template pTemplate="emptymessage" let-columns>
                <tr>
                    <td [attr.colspan]="columns?.length">
                        No records found
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th>Home Code</th>
                    <th>Home Name</th>
                    <th>User Type</th>
                    <th>Login Id</th>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-col let-i="rowIndex">
                <tr>
                    <td>{{col.homecode}}</td>
                    <td>{{col.homename}}</td>
                    <td>{{col.usertypename}}</td>
                    <td>{{col.loginid}}</td>
                    <td>{{col.firstname}} {{col.lastname}}</td>
                    <td>{{col.status==true?'Active':'Inactive'}}</td>                  
                    <td>
                        <a title="View/Edit" style="cursor: pointer;"
                            (click)="LoadUserDetails(col.userid)">
                            <i class="fa fa-eye" aria-hidden="true"></i>
                        </a>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
<div class="card" *ngIf="mode!=null">
    <form #myForm="ngForm">
        <p-accordion [multiple]="true" activeIndex="0,1">
            <p-accordionTab header="Personal Details">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Home<span class="danger">*</span></label>
                        <!-- <p-multiSelect name="ddlHome" [style]="{width: '100%'}" [options]="lstHomeMaster" 
                            [(ngModel)]="RegistrationMainModel.Homes" optionLabel="HomeName" optionValue="HomeMasterId"
                            placeholder="Please select Home" #homeref="ngModel" (onChange)="SetFacility()">
                        </p-multiSelect> -->
                        <p-dropdown [required]="true" name="ddlHome" [options]="lstHomeMaster"
                            [(ngModel)]="RegistrationMainModel.homemasterid" optionLabel="HomeName"
                            optionValue="HomeMasterId" [filter]="true" placeholder="--select--"
                            [style]="{width: '100%'}" #homeref="ngModel">
                        </p-dropdown>
                        <div *ngIf="homeref.errors &&(homeref.touched || homeref.dirty)"
                            class="errorMessage">
                            <div *ngIf="homeref.errors?.['required']">Home is required.</div>
                        </div>
                    </div>
                    
                    
                    <div class="col-md-3">
                        <label class="form-label">First Name<span class="danger">*</span></label>
                        <input pInputText type="text" required class="form-control" name="txtFName"
                        [(ngModel)]="RegistrationMainModel.firstname" placeholder=""
                        (keypress)="validateText($event)">                                
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Middle Name</label>
                        <input type="text" pInputText class="form-control" name="txtMiddleName"
                            [(ngModel)]="RegistrationMainModel.middlename" placeholder=""
                            (keypress)="validateText($event)">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Last Name</label>
                        <input type="text" pInputText class="form-control" name="txtLname"
                            [(ngModel)]="RegistrationMainModel.lastname" placeholder=""
                            (keypress)="validateText($event)">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Preferred Name</label>
                        <input pInputText type="text" class="form-control" name="txtFHName"
                            [(ngModel)]="RegistrationMainModel.preferredname"
                            placeholder="">
                    </div>
                    <!-- <div class="col-md-3">
                        <label class="form-label">Blood Group</label>
                        <p-dropdown name="ddlBloodGrp" [options]="stlstbloodgrp"
                            [(ngModel)]="RegistrationMainModel.BloodGroup" optionLabel="name" optionValue="code"
                            [filter]="true" placeholder="--select--" [style]="{width: '100%'}">
                        </p-dropdown>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Gender<span class="danger">*</span> </label>
                        <p-dropdown [required]="true" name="ddlGender" [options]="stlstgender"
                            [(ngModel)]="RegistrationMainModel.Gender" optionLabel="name" optionValue="code"
                            [filter]="true" placeholder="--select--" [style]="{width: '100%'}"
                            #genderref="ngModel">
                        </p-dropdown>
                        <div *ngIf="genderref.errors &&(genderref.touched || genderref.dirty)"
                            class="alert alert-danger">
                            <div *ngIf="genderref.errors?.['required']">Gender is required.</div>
                        </div>
                    </div>                                     -->
                    <div class="col-md-3">
                        <label class="form-label">Login Id</label>
                        <input type="text" pInputText disabled="disabled" class="form-control"
                            placeholder="Login Id" name="txtLoginId"
                            [(ngModel)]="RegistrationMainModel.loginid">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Password</label>
                        <input type="text" pInputText disabled="disabled" class="form-control"
                            placeholder="Password" name="txtPassword"
                            [(ngModel)]="RegistrationMainModel.password">
                    </div>                    
                    <div class="col-md-3">
                        <label class="form-label">Status <span class="danger">*</span></label>
                        <p-dropdown [required]="true" name="ddlStatus" [options]="stlststatus"
                            [(ngModel)]="RegistrationMainModel.status" optionLabel="name" optionValue="code"
                            [filter]="true" placeholder="Please Select Status" [style]="{width: '100%'}">
                        </p-dropdown>
                    </div>
                </div>
            </p-accordionTab>
            <p-accordionTab header="User details">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Date Of Birth</label>
                        <p-calendar [maxDate]="todayDate"
                            [(ngModel)]="RegistrationMainModel.dateofbirth"
                            [ngModelOptions]="{standalone: true}" [showIcon]="true" inputId="icon"
                            [dateFormat]="customDateFormat.CalendarFormat" #dobref="ngModel" class="iconcal"></p-calendar> 
                    </div>    
                    <div class="col-md-3">
                        <label class="form-label">Title</label>
                        <p-dropdown [required]="true" name="ddlTitle" [options]="stlsttitle"
                            [(ngModel)]="RegistrationMainModel.title" optionLabel="name" optionValue="code"
                            [filter]="true" placeholder="--select--" [style]="{width: '100%'}"
                           >
                        </p-dropdown>                        
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Designation</label>
                        <input type="text" pInputText name="txtDesignation" class="form-control"
                            [(ngModel)]="RegistrationMainModel.designation" (keypress)="validateText($event)" />              
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Date employment commenced</label>
                        <p-calendar [maxDate]="todayDate"
                            [(ngModel)]="RegistrationMainModel.employmentdate"
                            [ngModelOptions]="{standalone: true}" [showIcon]="true" inputId="icon"
                            [dateFormat]="customDateFormat.CalendarFormat" #empdateref="ngModel" class="iconcal"></p-calendar>
                    </div> 
                </div>
            </p-accordionTab> 
            <p-accordionTab header="Role">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">User Type<span class="danger">*</span></label>
                        <p-dropdown [required]="true"
                            name="ddlUserType" [options]="lstUserType"
                            [(ngModel)]="RegistrationMainModel.usertypeid" optionLabel="UserTypeName"
                            optionValue="UserTypeId" [filter]="true" placeholder="--select--"
                            [style]="{width: '100%'}" #usertyperef="ngModel">
                        </p-dropdown>
                        <div *ngIf="usertyperef.errors &&(usertyperef.touched || usertyperef.dirty)"
                            class="alert alert-danger">
                            <div *ngIf="usertyperef.errors?.['required']">User type is required.</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Region</label>
                        <input type="text" pInputText class="form-control"
                        placeholder="Region" name="txtRegion"
                        [(ngModel)]="RegistrationMainModel.region">
                    </div>
                </div>
            </p-accordionTab> 
            <p-accordionTab header="Facility and resident assignments">
                <div class="row">
                    <div class="col-md-12">
                        <p-table #dt67 [value]="lstFacilityResident" responsiveLayout="scroll" styleClass="p-datatable-striped"
                            [rowHover]="true" [scrollable]="true" scrollHeight="250px">
                            <ng-template pTemplate="emptymessage" let-columns>
                                <tr>
                                    <td [attr.colspan]="4">
                                        No records found
                                    </td>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>Facility Name</th>
                                    <th>Enable Facility</th>
                                    <th>Resident Auto-Assign</th>
                                    <th>Assign to individual residents</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-col let-i="rowIndex">
                                <tr>
                                    <td>{{col.FacilityName}}</td>
                                    <td>
                                        <p-checkbox                                                    
                                        name="ChkItemCheckEnableFacility_{{i}}"
                                        [(ngModel)]="col.EnableFacility" [binary]="true"
                                        inputId="binary"></p-checkbox>
                                    </td>
                                    <td>
                                        <p-checkbox                                                    
                                        name="ChkItemCheckEnableAutoAssignResident_{{i}}"
                                        [(ngModel)]="col.AutoAssignResident" [binary]="true"
                                        inputId="binary"></p-checkbox>
                                    </td>
                                    <td>
                                        <p-button *ngIf="col.EnableFacility==true" class="print-prew" (click)="$event.stopPropagation();ShowResidentDetails(col.HomeMasterId)">
                                            Assign Residents</p-button>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                
                </div>
            </p-accordionTab>
            <p-accordionTab header="Contact details">
                <div class="row">                    
                    <div class="col-md-3">
                        <label class="form-label">Contact address</label>
                        <input type="text" pInputText id='txtAddress' class="form-control" name="txtAddress"
                            [(ngModel)]="RegistrationMainModel.address" (keypress)="validateText($event)" />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Location</label>
                        <input type="text" pInputText class="form-control" placeholder=""
                            name="Location" [(ngModel)]="RegistrationMainModel.location">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Phone (area - local)</label>
                        <input type="text" pInputText class="form-control" placeholder=""
                            name="Phone" [(ngModel)]="RegistrationMainModel.Phone">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Fax (area - local)</label>
                        <input type="text" pInputText class="form-control" placeholder=""
                            name="Fax" [(ngModel)]="RegistrationMainModel.fax">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Pager (area - local)</label>
                        <input type="text" pInputText class="form-control" placeholder="" name="Pager"
                            [(ngModel)]="RegistrationMainModel.pager" (keypress)="validateNumber($event)">                        
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Mobile phone </label>
                        <input type="text" pInputText class="form-control" name="txtContactNumber"
                            [(ngModel)]="RegistrationMainModel.contactnumber" (keypress)="validateNumber($event)"
                            placeholder="" pattern="[0-9]{10}$" minlength="10" maxlength="10"
                            #mobileref="ngModel">
                        <div *ngIf="mobileref.errors &&(mobileref.touched || mobileref.dirty)"
                            class="alert alert-danger">
                            <div *ngIf="mobileref.errors?.['pattern']">Please, Enter 10 digit Mobile
                                Number.
                            </div>
                        </div>
                    </div>                    
                    <div class="col-md-3">
                        <label class="form-label">Email address 1</label>
                        <input type="email" pInputText class="form-control" placeholder="" name="txtEmail"
                            [(ngModel)]="RegistrationMainModel.email1"
                            pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" #emailref1="ngModel">
                        <div *ngIf="emailref1.errors &&(emailref1.touched || emailref1.dirty)"
                            class="alert alert-danger">
                            <div [hidden]="!emailref1.errors?.['pattern']">
                                Invalid pattern
                            </div>
                        </div>
                    </div> 
                    <div class="col-md-3">
                        <label class="form-label">Email address 2</label>
                        <input type="email" pInputText class="form-control" placeholder="" name="txtEmail"
                            [(ngModel)]="RegistrationMainModel.email2"
                            pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" #emailref2="ngModel">
                        <div *ngIf="emailref2.errors &&(emailref2.touched || emailref2.dirty)"
                            class="alert alert-danger">
                            <div [hidden]="!emailref2.errors?.['pattern']">
                                Invalid pattern
                            </div>
                        </div>
                    </div> 
                    <div class="col-md-3">
                        <label class="form-label">Comments</label>
                        <textarea rows="3" cols="30"  name="comments" [(ngModel)]="RegistrationMainModel.comments"  placeholder="" pInputTextarea></textarea>
                        
                    </div>
                </div>                
            </p-accordionTab>            
            
            <p-accordionTab header="Emergency contact">
                <div class="row">
                    <div class="col-md-3">
                        <label class="form-label">Name</label>
                        <input type="text" pInputText class="form-control"
                            placeholder="" name="txtEmergencyContactName"
                            [(ngModel)]="RegistrationMainModel.emergencycontactname">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Address</label>
                        <input type="text" pInputText class="form-control"
                            placeholder="" name="txtEmergencyContactAddress"
                            [(ngModel)]="RegistrationMainModel.emergencycontactaddress">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Telephone</label>
                        <input type="text" pInputText class="form-control"
                            placeholder="" name="txtEmergencyContactTelephone"
                            [(ngModel)]="RegistrationMainModel.emergencycontacttelephone">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Mobile</label>
                        <input type="text" pInputText class="form-control"
                            placeholder="" name="txtEmergencyContactMobile"
                            [(ngModel)]="RegistrationMainModel.emergencycontactmobile">
                    </div>
                </div>
            </p-accordionTab>           
        </p-accordion>                
            <div class="flex flex-wrap gap-2">
                <button pButton type="button" label="Submit" (click)="Submit()"
                    [disabled]="!myForm.form.valid"></button>
                <button pButton type="button" label="Close" class="p-button-secondary"
                    (click)="CloseModal()"></button>
            </div>                
    </form>
</div>   
<p-dialog id="ShowResidentFacilityModel"  [(visible)]="ShowResidentFacilityModel" [modal]="true"
    [style]="{width: '70vw'}" [maximizable]="true" [closeOnEscape]="true" [closable]="true" [draggable]="false"
    [resizable]="true">
    <ng-template pTemplate="header">
        <h3>Resident List Facility</h3>
    </ng-template>
    <ng-template pTemplate="body">
        <div class="row">
            <div class="col-md-12">
                <p-table #dt67 [value]="lstResidentfacility" responsiveLayout="scroll" styleClass="p-datatable-striped"
                    [rowHover]="true" [scrollable]="true" scrollHeight="250px">
                    <ng-template pTemplate="emptymessage" let-columns>
                        <tr>
                            <td [attr.colspan]="4">
                                No records found
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Check</th>
                            <th>Resident Name</th>
                            <th>Facility Name</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-col let-i="rowIndex">
                        <tr>
                            <td>
                                <p-checkbox                                                    
                                [ngModelOptions]="{standalone: true}"
                                [(ngModel)]="col.Checked" [binary]="true"
                                inputId="binary" (onChange)="CheckUncheckResidentFacility($event,col.UserId)"></p-checkbox>
                            </td>
                            <td>
                               {{col.FullName}}
                            </td>
                            <td>
                               {{col.HomeName}}
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </ng-template>
</p-dialog>
